<div class="p-32">
  <div class="flex items-center mb-4">
    <%= link_to workdays_path, class: "border rounded p-2 mr-4 hover:bg-gray-50" do%>
    <%= image_tag("icons/ArrowLeftMinor.svg", class: "h-6")%>
    <%end %>
    <h1 class="text-3xl">Jornada: <%= @workday.work_date %></h1>
  </div>
  <div class="flex mb-4">
    <% @workday.workday_products.each do |wd_product| %>
    <div class="border w-48 bg-white rounded-lg p-2 flex flex-col items-center justify-center mr-4">
      <% if wd_product.cover_photo.attached?%>
      <%= image_tag wd_product.cover_photo.variant(gravity: "center", resize: "400x400^", crop: '400x400+0+0'), class: "w-40 overflow-hidden rounded-lg mb-2" %>
      <% end %>
      <div class="w-full flex justify-between">
        <div class="text-xl"><%= wd_product.name %></div>
        <div class="text-xl">Stock: <%= wd_product.stock %></div>
      </div>
      <%= link_to "Eliminar", workday_product_path(wd_product), class: "text-red-500",method: :delete, data: {confirm: "¿Estás seguro de que quieres eliminar el stock?"}%>
    </div>
    <% end %>
    <%= link_to new_workday_product_path(workday_id: @workday.id) do %>

    <div class="border h-40 w-full bg-white rounded-lg p-4 flex flex-col items-center justify-center cursor-pointer">
      <%= image_tag("icons/AddMajor.svg", class: "h-16 mb-2")%>
      <h2 class="text-xl">Agregar stock</h2>
    </div>
    <% end %>
  </div>
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl">Pedidos</h2>
    <%= link_to "Hacer un pedido", new_order_path(workday_id: @workday.id), class: "border-2 border-green-700 bg-green-100 text-green-700 px-4 py-2 rounded-md "%>
  </div>
  <div class="bg-white border rounded-lg">
    <div class="flex flex-col mx-auto">
      <div class="overflow-x-scroll">
        <table class="table-fixed min-w-full">
          <thead>
            <tr class="border-b h-14">
              <th class="text-left pl-4">ID</th>
              <th class="text-left">Cliente</th>
              <th class="text-right">Productos</th>
              <th class="text-right">Subtotal</th>
              <th class="text-right">Total</th>
              <th class="text-right">Pagado</th>
              <th class="text-right pr-4">Acciones </th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b h-14 bg-yellow-50">
              <td class="text-left pl-4"></td>
              <td class="text-left font-bold">Totales</td>
              <td class="text-right">
                <% @workday.products.each do |product| %>
                <div>
                  <%= OrderCalculator.units_taken(@workday, product)  %> x <%= product.name %>
                </div>
                <% end %>
              </td>
              <td class="text-right">
                <% @workday.products.each do |product| %>
                <div>
                  <%= currency_formatter(OrderCalculator.revenue_at(@workday, product))  %>
                </div>
                <% end %>
              </td>
              <td class="text-right">
                <%= currency_formatter(OrderCalculator.revenue_at(@workday))  %>
              </td>
              <td></td>
              <td></td>

            </tr>
            <% @workday.orders.each do |order| %>
            <tr class="border-b h-14">
              <td class="text-left pl-4"># <%= order.id %></td>
              <td class="text-left"><%= order.customer.full_name %> - D. <%= order.customer.apartment %></td>
              <td class="text-right">
                <% order.order_products.each do |order_product| %>
                <div>
                  <%= order_product.quantity%> x <%= order_product.name %>
                </div>
                <% end %>
              </td>
              <td class="text-right">
                <% order.order_products.each do |order_product| %>
                <div>
                  <%= currency_formatter(order_product.price)%>
                </div>
                <% end %>
              </td>
              <td class="text-right"><%= currency_formatter(order.total_price) %></td>
              <td class="text-right"><%= order.paid? %></td>
              <td class="text-right pr-4">
                <%= link_to "Eliminar", order, class: "text-red-400",  method: :delete, data: {confirm: "¿Estás seguro de eliminar el pedido?" }%>
              </td>
            </tr>

            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>